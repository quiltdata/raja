# RAJA Web Interface

A simple, elegant web-based demo interface for the RAJA (Resource Authorization with JWT and Scopes) MVP system.

## Overview

This web interface provides a visual demonstration of RAJA's authorization capabilities through three interactive panels:

1. **Token Issuance** - Request JWT tokens for different principals (users)
2. **Authorization Testing** - Test authorization decisions with tokens
3. **Token Introspection** - Decode and inspect JWT token claims

## Features

- **Pure HTML/CSS/JavaScript** - No build tools or frameworks required
- **Responsive Design** - Works on desktop, tablet, and mobile
- **Real-time API Integration** - Directly calls RAJA backend REST API
- **User-Friendly Interface** - Clear visual feedback for all operations
- **Example-Driven** - Pre-filled examples and quick-select buttons
- **Copy-to-Clipboard** - Easy token copying between panels

## Files

- `index.html` - Main HTML structure with three-panel layout
- `app.js` - JavaScript application logic and API calls
- `styles.css` - CSS styling for clean, modern look
- `config.js` - Configuration file (generated by CDK deployment)

## Local Development

### Option 1: Simple HTTP Server (Python)

```bash
cd web
python3 -m http.server 8080
```

Then open http://localhost:8080 in your browser.

### Option 2: Node.js HTTP Server

```bash
cd web
npx http-server -p 8080
```

### Option 3: VS Code Live Server Extension

1. Install the "Live Server" extension in VS Code
2. Right-click on `index.html` and select "Open with Live Server"

### Configure API Endpoint

For local development, create a `config.js` file:

```javascript
window.RAJA_CONFIG = {
    apiUrl: 'https://your-api-gateway-url.amazonaws.com/prod'
};
```

Replace with your actual API Gateway URL from the CDK deployment outputs.

## Deployment

The web interface is automatically deployed via AWS CDK:

```bash
# Deploy the web stack
poe cdk deploy RajaWebStack
```

The CDK stack will:
1. Create an S3 bucket for static hosting
2. Deploy all web files to S3
3. Create a CloudFront distribution for HTTPS access
4. Automatically inject the API Gateway URL into `config.js`
5. Output the CloudFront URL for accessing the interface

## Usage

### 1. Request a Token

1. Enter a principal name (e.g., "alice", "bob", or "admin")
2. Click "Request Token"
3. View the issued JWT token and granted scopes
4. Copy the token for use in other panels

### 2. Test Authorization

1. Paste a token (or use the token from Step 1)
2. Enter resource type, resource ID, and action
3. Click "Check Authorization"
4. See ALLOW/DENY decision with reason and matched scope

### 3. Inspect Token

1. Paste a token to inspect
2. Click "Inspect Token"
3. View decoded JWT claims including subject, scopes, and expiration

## Example Workflows

### Workflow 1: Alice Reads Document

1. Request token for "alice"
2. Test authorization: Document:doc123:read
3. Result: ALLOWED (if policy grants this)
4. Introspect token to verify "Document:doc123:read" scope

### Workflow 2: Unauthorized Access

1. Request token for "bob"
2. Test authorization: Document:doc123:write
3. Result: DENIED (if policy doesn't grant this)
4. See reason: "Scope not found in token"

### Workflow 3: Admin Full Access

1. Request token for "admin"
2. Test various document actions
3. See all operations allowed
4. Introspect to see comprehensive scopes

## Architecture

### Frontend → Backend Flow

```
┌──────────────┐
│   Browser    │
│ (index.html) │
└──────┬───────┘
       │
       │ app.js
       ▼
┌──────────────┐
│ API Gateway  │
│  REST API    │
└──────┬───────┘
       │
       ├─► POST /token → Token Service Lambda
       │
       ├─► POST /authorize → Enforcer Lambda
       │
       └─► GET /introspect → Introspect Lambda
```

### API Endpoints Used

- **POST /token** - Issue JWT token with scopes
  - Request: `{"principal": "alice"}`
  - Response: `{"token": "eyJ...", "scopes": [...]}`

- **POST /authorize** - Check authorization
  - Request: `{"token": "...", "request": {...}}`
  - Response: `{"allowed": true/false, "reason": "..."}`

- **GET /introspect** - Decode token
  - Query: `?token=eyJ...`
  - Response: `{"claims": {...}}`

## Error Handling

The interface handles various error scenarios:

- **Invalid principal** - "Principal not found" error
- **Expired token** - "Token has expired" message
- **Invalid token** - "Invalid token signature" error
- **Network errors** - Connection failure messages
- **Missing fields** - Validation prompts

## Customization

### Change Branding

Edit `index.html`:
- Update `<h1>` title
- Modify `.subtitle` text
- Change footer content

### Modify Styling

Edit `styles.css`:
- Update CSS variables in `:root` for colors
- Adjust padding/margins in `.panel`
- Customize button styles in `.btn-*`

### Add Features

Edit `app.js`:
- Add new API endpoints
- Implement additional panels
- Enhance error handling

## Testing

### Manual Testing Checklist

- [ ] Token issuance for valid principal works
- [ ] Token issuance for invalid principal shows error
- [ ] Copy token button works
- [ ] Authorization with valid token + allowed scope shows ALLOW
- [ ] Authorization with valid token + denied scope shows DENY
- [ ] Authorization with invalid token shows error
- [ ] Token introspection displays decoded claims
- [ ] All example buttons populate fields correctly
- [ ] Responsive design works on mobile
- [ ] Loading states display during API calls

## Troubleshooting

### "API URL not configured" Warning

Create or check `config.js`:
```javascript
window.RAJA_CONFIG = {
    apiUrl: 'https://your-api-url.com'
};
```

### CORS Errors

Ensure API Gateway has CORS enabled:
- Allow origins: `*` (or specific CloudFront domain)
- Allow methods: GET, POST, OPTIONS
- Allow headers: Content-Type

### Token Not Working

1. Check token hasn't expired (default TTL: 3600 seconds)
2. Verify principal has scopes in DynamoDB
3. Ensure compiler Lambda has run to populate scopes

### Network Errors

1. Verify API Gateway is deployed and accessible
2. Check browser console for detailed error messages
3. Test API endpoints directly with curl/Postman

## Future Enhancements

Potential improvements (not in current scope):

- Policy editor with Cedar syntax highlighting
- Real-time policy updates via WebSocket
- Admin panel for user/policy management
- Authentication with AWS Cognito
- Audit log viewer
- Token expiration countdown
- Dark mode toggle
- Export token/results as JSON

## Security Notes

- Tokens are displayed in the browser (for demo purposes)
- No sensitive data should be used in production demo
- HTTPS enforced via CloudFront in deployed version
- Content Security Policy can be added via CloudFront headers

## Support

For issues or questions:
1. Check the main RAJA README
2. Review API Gateway logs in CloudWatch
3. Test API endpoints independently
4. Verify CDK deployment completed successfully
